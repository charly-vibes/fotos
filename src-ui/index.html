<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fotos</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/canvas.css">
  <link rel="stylesheet" href="css/themes.css">
</head>
<body>
  <!-- Custom title bar -->
  <div id="titlebar" data-tauri-drag-region>
    <span id="titlebar-title">Fotos</span>
    <div id="titlebar-controls">
      <button id="btn-minimize" title="Minimize">&#8722;</button>
      <button id="btn-maximize" title="Maximize">&#9633;</button>
      <button id="btn-close" title="Close">&#10005;</button>
    </div>
  </div>

  <!-- Top toolbar -->
  <header id="toolbar">
    <div class="tool-group" id="capture-tools">
      <button data-action="capture-region" title="Capture Region (Ctrl+Shift+S)">üìê</button>
      <button data-action="capture-fullscreen" title="Capture Fullscreen (Ctrl+Shift+A)">üì∑</button>
      <button data-action="capture-window" title="Capture Window (Alt+PrtScn)">ü™ü</button>
    </div>

    <div class="separator"></div>

    <div class="tool-group" id="annotation-tools">
      <button data-tool="arrow" title="Arrow (A)">‚Üí</button>
      <button data-tool="rect" title="Rectangle (R)">‚ñ≠</button>
      <button data-tool="ellipse" title="Ellipse (E)">‚óã</button>
      <button data-tool="text" title="Text (T)">T</button>
      <button data-tool="blur" title="Blur (B)">‚äô</button>
      <button data-tool="step" title="Step Number (N)">1</button>
      <button data-tool="freehand" title="Freehand (F)">‚úè</button>
      <button data-tool="highlight" title="Highlight (H)">üñç</button>
      <button data-tool="crop" title="Crop (C)">‚úÇ</button>
      <button data-tool="select" title="Select (V)">‚ñ≤</button>
    </div>

    <div class="separator"></div>

    <div class="tool-group" id="style-controls">
      <div id="color-picker-trigger"></div>
      <div id="size-picker"></div>
    </div>

    <div class="separator"></div>

    <div class="tool-group" id="history-controls">
      <button data-action="undo" title="Undo (Ctrl+Z)">‚Ü∂</button>
      <button data-action="redo" title="Redo (Ctrl+Shift+Z)">‚Ü∑</button>
    </div>

    <div class="separator"></div>

    <div class="tool-group" id="zoom-controls">
      <button data-action="zoom-fit" title="Fit to Page (Ctrl+0)">‚ä°</button>
      <button data-action="zoom-100" title="100% (Ctrl+1)">1:1</button>
      <button data-action="zoom-out" title="Zoom Out (-)">‚àí</button>
      <button data-action="zoom-in" title="Zoom In (+)">+</button>
    </div>

    <div class="spacer"></div>

    <div class="tool-group" id="ai-tools">
      <button data-action="ocr" title="Extract Text (OCR)">OCR</button>
      <button data-action="auto-blur" title="Auto-Blur PII">üîí</button>
      <button data-action="ai-analyze" title="AI Analyze">ü§ñ</button>
    </div>

    <div class="separator"></div>

    <div class="tool-group" id="output-tools">
      <button data-action="copy-clipboard" title="Copy (Ctrl+C)">üìã</button>
      <button data-action="save" title="Save (Ctrl+S)">üíæ</button>
      <button data-action="save-as" title="Save As">üìÅ</button>
    </div>

    <div class="separator"></div>

    <div class="tool-group">
      <button data-action="open-settings" title="Settings">‚öô</button>
    </div>
  </header>

  <!-- Main canvas area -->
  <main id="canvas-container">
    <canvas id="canvas-base"></canvas>
    <canvas id="canvas-annotations"></canvas>
    <canvas id="canvas-active"></canvas>
    <textarea id="text-input" class="hidden"></textarea>
  </main>

  <!-- Collapsible AI results panel -->
  <aside id="ai-panel" class="collapsed">
    <div id="ai-panel-header">
      <span>AI Results</span>
      <button data-action="toggle-ai-panel"></button>
    </div>
    <div id="ai-panel-content">
      <div id="ocr-results" class="hidden"></div>
      <div id="llm-results" class="hidden"></div>
    </div>
  </aside>

  <!-- Status bar -->
  <footer id="statusbar">
    <span id="status-dimensions"></span>
    <span id="status-zoom"></span>
    <span id="status-tool"></span>
    <span id="status-message"></span>
  </footer>

  <div id="toast" aria-live="polite"></div>

  <div id="region-picker-overlay" class="hidden">
    <canvas id="region-picker-canvas"></canvas>
    <p id="region-picker-hint">Drag to select ¬∑ Enter to confirm ¬∑ Esc to cancel</p>
  </div>

  <!-- Settings modal -->
  <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
      <div class="modal-header">
        <h2 id="settings-title">Settings</h2>
        <button class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <nav class="settings-tabs" role="tablist">
          <button class="settings-tab-btn active" data-tab="capture" role="tab">Capture</button>
          <button class="settings-tab-btn" data-tab="annotation" role="tab">Annotation</button>
          <button class="settings-tab-btn" data-tab="ai" role="tab">AI</button>
          <button class="settings-tab-btn" data-tab="ui" role="tab">Interface</button>
          <button class="settings-tab-btn" data-tab="keys" role="tab">API Keys</button>
        </nav>

        <!-- Capture tab -->
        <div id="tab-capture" class="settings-tab-panel active">
          <div class="settings-row">
            <label class="settings-label" for="pref-capture-defaultMode">Default mode</label>
            <div class="settings-control">
              <select id="pref-capture-defaultMode">
                <option value="region">Region</option>
                <option value="fullscreen">Fullscreen</option>
                <option value="monitor">Monitor</option>
                <option value="window">Window</option>
              </select>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-capture-defaultFormat">Default format</label>
            <div class="settings-control">
              <select id="pref-capture-defaultFormat">
                <option value="png">PNG</option>
                <option value="jpg">JPEG</option>
                <option value="webp">WebP</option>
              </select>
            </div>
          </div>
          <div class="settings-row" id="row-jpeg-quality">
            <label class="settings-label" for="pref-capture-jpegQuality">JPEG quality</label>
            <div class="settings-control settings-control--range">
              <input type="range" id="pref-capture-jpegQuality" min="1" max="100" step="1">
              <span id="pref-capture-jpegQuality-display">90</span>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-capture-saveDirectory">Save directory</label>
            <div class="settings-control">
              <input type="text" id="pref-capture-saveDirectory" placeholder="~/Pictures/Fotos">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label settings-label--checkbox">
              <input type="checkbox" id="pref-capture-copyToClipboard">
              Copy to clipboard after capture
            </label>
          </div>
          <div class="settings-row">
            <label class="settings-label settings-label--checkbox">
              <input type="checkbox" id="pref-capture-includeMouseCursor">
              Include mouse cursor
            </label>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-capture-delayMs">Capture delay (ms)</label>
            <div class="settings-control">
              <input type="number" id="pref-capture-delayMs" min="0" max="10000" step="100">
            </div>
          </div>
        </div>

        <!-- Annotation tab -->
        <div id="tab-annotation" class="settings-tab-panel">
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-strokeColor">Stroke color</label>
            <div class="settings-control">
              <input type="color" id="pref-annotation-strokeColor">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-strokeWidth">Stroke width (px)</label>
            <div class="settings-control">
              <input type="number" id="pref-annotation-strokeWidth" min="0.5" max="50" step="0.5">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-fontSize">Font size (px)</label>
            <div class="settings-control">
              <input type="number" id="pref-annotation-fontSize" min="6" max="200" step="1">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-fontFamily">Font family</label>
            <div class="settings-control">
              <input type="text" id="pref-annotation-fontFamily" placeholder="sans-serif">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-stepColor">Step number color</label>
            <div class="settings-control">
              <input type="color" id="pref-annotation-stepColor">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-stepSize">Step number size (px)</label>
            <div class="settings-control">
              <input type="number" id="pref-annotation-stepSize" min="12" max="120" step="1">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-annotation-blurRadius">Blur radius (px)</label>
            <div class="settings-control">
              <input type="number" id="pref-annotation-blurRadius" min="1" max="100" step="1">
            </div>
          </div>
        </div>

        <!-- AI tab -->
        <div id="tab-ai" class="settings-tab-panel">
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-ocrLanguage">OCR language</label>
            <div class="settings-control">
              <select id="pref-ai-ocrLanguage">
                <option value="eng">English (eng)</option>
                <option value="fra">French (fra)</option>
                <option value="deu">German (deu)</option>
                <option value="spa">Spanish (spa)</option>
              </select>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-defaultProvider">Default LLM provider</label>
            <div class="settings-control">
              <select id="pref-ai-defaultProvider">
                <option value="claude">Claude (Anthropic)</option>
                <option value="openai">GPT-4o (OpenAI)</option>
                <option value="gemini">Gemini (Google)</option>
                <option value="ollama">Ollama (local)</option>
              </select>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-claudeModel">Claude model</label>
            <div class="settings-control">
              <input type="text" id="pref-ai-claudeModel" placeholder="claude-sonnet-4-20250514">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-openaiModel">OpenAI model</label>
            <div class="settings-control">
              <input type="text" id="pref-ai-openaiModel" placeholder="gpt-4o">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-geminiModel">Gemini model</label>
            <div class="settings-control">
              <input type="text" id="pref-ai-geminiModel" placeholder="gemini-2.0-flash">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-ollamaUrl">Ollama URL</label>
            <div class="settings-control">
              <input type="url" id="pref-ai-ollamaUrl" placeholder="http://localhost:11434">
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label" for="pref-ai-ollamaModel">Ollama model</label>
            <div class="settings-control">
              <input type="text" id="pref-ai-ollamaModel" placeholder="llava:7b">
            </div>
          </div>
        </div>

        <!-- Interface tab -->
        <div id="tab-ui" class="settings-tab-panel">
          <div class="settings-row">
            <label class="settings-label" for="pref-ui-theme">Theme</label>
            <div class="settings-control">
              <select id="pref-ui-theme">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label settings-label--checkbox">
              <input type="checkbox" id="pref-ui-showAiPanel">
              Show AI results panel
            </label>
          </div>
          <div class="settings-row">
            <label class="settings-label settings-label--checkbox">
              <input type="checkbox" id="pref-ui-showStatusBar">
              Show status bar
            </label>
          </div>
        </div>

        <!-- API Keys tab -->
        <div id="tab-keys" class="settings-tab-panel">
          <p class="settings-hint">Keys are stored in your OS keychain and never saved in plain text.</p>

          <div class="api-key-row" data-provider="anthropic">
            <div class="api-key-label">
              <span class="provider-name">Anthropic (Claude)</span>
              <span class="key-status key-status--missing">No key set</span>
            </div>
            <div class="api-key-controls">
              <div class="api-key-input-wrap">
                <input type="password" class="api-key-input" placeholder="sk-ant-..." autocomplete="off" spellcheck="false">
                <button class="btn-show-hide">Show</button>
              </div>
              <div class="api-key-actions">
                <button class="btn-save-key">Save</button>
                <button class="btn-test-key">Test</button>
                <button class="btn-delete-key">Delete</button>
              </div>
            </div>
          </div>

          <div class="api-key-row" data-provider="openai">
            <div class="api-key-label">
              <span class="provider-name">OpenAI (GPT-4o)</span>
              <span class="key-status key-status--missing">No key set</span>
            </div>
            <div class="api-key-controls">
              <div class="api-key-input-wrap">
                <input type="password" class="api-key-input" placeholder="sk-..." autocomplete="off" spellcheck="false">
                <button class="btn-show-hide">Show</button>
              </div>
              <div class="api-key-actions">
                <button class="btn-save-key">Save</button>
                <button class="btn-test-key">Test</button>
                <button class="btn-delete-key">Delete</button>
              </div>
            </div>
          </div>

          <div class="api-key-row" data-provider="gemini">
            <div class="api-key-label">
              <span class="provider-name">Google (Gemini)</span>
              <span class="key-status key-status--missing">No key set</span>
            </div>
            <div class="api-key-controls">
              <div class="api-key-input-wrap">
                <input type="password" class="api-key-input" placeholder="AIza..." autocomplete="off" spellcheck="false">
                <button class="btn-show-hide">Show</button>
              </div>
              <div class="api-key-actions">
                <button class="btn-save-key">Save</button>
                <button class="btn-test-key">Test</button>
                <button class="btn-delete-key">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-reset-defaults">Reset to Defaults</button>
        <button class="btn-close-settings">Close</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
